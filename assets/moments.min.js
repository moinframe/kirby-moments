var m={close:'<svg viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg" aria-hidden="true" class="moments-icon moments-icon-close"><path d="M10.5859 12L2.79297 4.20706L4.20718 2.79285L12.0001 10.5857L19.793 2.79285L21.2072 4.20706L13.4143 12L21.2072 19.7928L19.793 21.2071L12.0001 13.4142L4.20718 21.2071L2.79297 19.7928L10.5859 12Z" fill="currentColor"/></svg>',prev:'<svg viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg" aria-hidden="true" class="moments-icon moments-icon-prev"><path d="M7.82843 10.9999H20V12.9999H7.82843L13.1924 18.3638L11.7782 19.778L4 11.9999L11.7782 4.22168L13.1924 5.63589L7.82843 10.9999Z" fill="currentColor"/></svg>',next:'<svg viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg" aria-hidden="true" class="moments-icon moments-icon-next"><path d="M16.1716 10.9999L10.8076 5.63589L12.2218 4.22168L20 11.9999L12.2218 19.778L10.8076 18.3638L16.1716 12.9999H4V10.9999H16.1716Z" fill="currentColor"/></svg>',clock:'<svg viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg" aria-hidden="true" class="moments-icon moments-icon-clock"><path d="M12 22C6.47715 22 2 17.5228 2 12C2 6.47715 6.47715 2 12 2C17.5228 2 22 6.47715 22 12C22 17.5228 17.5228 22 12 22ZM12 20C16.4183 20 20 16.4183 20 12C20 7.58172 16.4183 4 12 4C7.58172 4 4 7.58172 4 12C4 16.4183 7.58172 20 12 20ZM13 12H17V14H11V7H13V12Z" fill="currentColor"/></svg>'},a=class extends HTMLElement{dialog=null;placeholder=null;closeUrl="";currentMoment=null;momentDataMap=new Map;lastFocusedElement=null;boundPopstateHandler;boundKeydownHandler;constructor(){super(),this.boundPopstateHandler=this.handlePopstate.bind(this),this.boundKeydownHandler=this.handleKeydown.bind(this)}connectedCallback(){this.closeUrl=this.getAttribute("close-url")||"/",this.dialog=this.querySelector("dialog.moments-lightbox"),this.placeholder=this.querySelector("[data-placeholder]"),this.querySelectorAll("a[data-moment]").forEach(e=>{let t=e.getAttribute("data-moment");if(t)try{let n=JSON.parse(t);this.momentDataMap.set(n.url,n)}catch(n){console.error("Failed to parse moment data:",n)}}),this.addEventListener("click",this.handleClick.bind(this)),window.addEventListener("popstate",this.boundPopstateHandler),this.checkUrlForMoment()}disconnectedCallback(){window.removeEventListener("popstate",this.boundPopstateHandler)}handleClick(e){let t=e.target;if(t.closest(".moments-close")){e.preventDefault(),this.closeLightbox(!0);return}let o=t.closest("a[data-moment]");if(o){e.preventDefault();let s=o.getAttribute("data-moment");if(s)try{let i=JSON.parse(s);this.lastFocusedElement=o,this.openMoment(i,!0)}catch(i){console.error("Failed to parse moment data:",i)}}}checkUrlForMoment(){let e=window.location.pathname;for(let[t,n]of this.momentDataMap){let o=new URL(t,window.location.origin).pathname;if(e===o){this.openMoment(n,!1);return}}}handlePopstate(e){let t=window.location.pathname;for(let[n,o]of this.momentDataMap){let s=new URL(n,window.location.origin).pathname;if(t===s){this.openMoment(o,!1);return}}this.closeLightbox(!1)}openMoment(e,t){if(!this.dialog||!this.placeholder)return;this.currentMoment=e,this.renderMoment(e),this.dialog.showModal(),t&&history.pushState({moment:e.url},"",e.url),this.dialog.querySelector(".moments-close")?.focus(),this.dialog.addEventListener("keydown",this.boundKeydownHandler),this.preloadAdjacentImages(e)}renderMoment(e){if(!this.placeholder)return;let t="";e.image&&(t+='<figure class="moments-image"><picture>',e.image.webpSrcset&&(t+=`<source srcset="${e.image.webpSrcset}" sizes="${e.image.sizes}" type="image/webp">`),t+=`<img alt="${this.escapeHtml(e.image.alt)}" src="${e.image.src}" srcset="${e.image.srcset}" sizes="${e.image.sizes}" width="${e.image.width}" height="${e.image.height}">`,t+="</picture></figure>",t+='<div class="moments-image-footer">',e.text&&(t+=`<div class="moments-image-footer__text"><p>${this.escapeHtml(e.text)}</p></div>`),e.date&&(t+=`<moments-time class="moments-image-footer__time">${m.clock}<time datetime="${e.date.timestamp}">${e.date.formatted}</time></moments-time>`),t+="</div>"),t+='<div class="moments-controls">',e.prev&&(t+=`<a href="${e.prev}" class="moments-controls__prev" rel="nofollow" data-nav="prev">${m.prev}</a>`),e.next&&(t+=`<a href="${e.next}" class="moments-controls__next" rel="nofollow" data-nav="next">${m.next}</a>`),t+="</div>",this.placeholder.innerHTML=t,this.placeholder.querySelectorAll("[data-nav]").forEach(n=>{n.addEventListener("click",o=>{o.preventDefault();let s=n.getAttribute("href");if(s){let i=this.momentDataMap.get(s);i&&this.openMoment(i,!0)}})})}closeLightbox(e){this.dialog&&(this.dialog.close(),this.currentMoment=null,this.dialog.removeEventListener("keydown",this.boundKeydownHandler),e&&history.pushState(null,"",this.closeUrl),this.lastFocusedElement?.focus())}handleKeydown(e){if(!(!this.dialog||!this.currentMoment))switch(e.code){case"ArrowLeft":if(this.currentMoment.prev){let t=this.momentDataMap.get(this.currentMoment.prev);t&&(e.preventDefault(),this.openMoment(t,!0))}break;case"ArrowRight":if(this.currentMoment.next){let t=this.momentDataMap.get(this.currentMoment.next);t&&(e.preventDefault(),this.openMoment(t,!0))}break;case"Escape":e.preventDefault(),this.closeLightbox(!0);break;case"Tab":this.handleTabKey(e);break}}handleTabKey(e){if(!this.dialog)return;let n=Array.from(this.dialog.querySelectorAll('a[href], button:not([disabled]), [tabindex]:not([tabindex="-1"])'));if(n.length===0)return;let o=n[0],s=n[n.length-1];e.shiftKey?document.activeElement===o&&(e.preventDefault(),s.focus()):document.activeElement===s&&(e.preventDefault(),o.focus())}preloadAdjacentImages(e){let t=[];if(e.prev){let n=this.momentDataMap.get(e.prev);n?.image?.src&&t.push(n.image.src)}if(e.next){let n=this.momentDataMap.get(e.next);n?.image?.src&&t.push(n.image.src)}t.forEach(n=>{let o=new Image;o.src=n})}escapeHtml(e){let t=document.createElement("div");return t.textContent=e,t.innerHTML}};var l=class extends HTMLElement{connectedCallback(){let e=this.querySelector("time");if(!e)return;let t=e.getAttribute("datetime");if(!t)return;let n=this.formatRelativeDate(t);n&&(e.textContent=n)}formatRelativeDate(e){let t=document.documentElement.lang||"en",n=Date.now(),o=new Date(e).getTime();if(isNaN(o))return;let s=n-o,i=Math.floor(s/864e5);if(i>=3)return;let r=new Intl.RelativeTimeFormat(t,{numeric:"auto"});if(i<1){let c=Math.floor(s/36e5);if(c>=1)return r.format(-c,"hour");let h=Math.floor(s/6e4);if(h>=1)return r.format(-h,"minute");let u=Math.floor(s/1e3);return r.format(-u,"second")}return r.format(-i,"day")}};customElements.define("moments-lightbox",a);customElements.define("moments-time",l);
